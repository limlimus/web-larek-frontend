# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс продукта
```
export interface IProductItem {
  id: TProductId;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```
Интерфейс данных, отправляемых при заказе

```
export interface IOrderRequest {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: TProductId[];
}
```

Интерфейс данных, получаемых при заказе
```
export interface IOrderResponse {
  orderId: string;
  total: number;
}
```
Интерфейс ошибки запроса
```
export interface IRequestError {
  error: string;
}
```
Модель каталога продуктов
```
export interface ICatalogItems {
  total: number;
  items: IProductItem[];
  setItems(items: IProductItem[]):void;
  getProduct(id:string): IProductItem[];
}
```
Тип идентификатора продукта
```
export type TProductId = string;
```
Данные продукта, отображаемые в корзине
```
export type TProductBaseInfo = Pick<IProductItem, 'title' | 'id'>;
```
Данные продукта, отображаемые в каталоге
```
export type TProductPublicInfo = Pick<IProductItem, 'title' | 'image' | 'price' | 'category'>;
```
Тип оплаты
```
export type TPayment = "online" | "cash";
```
Данные, используемые в форме выбора оплаты и адреса
```
export type TAddressForm = Pick<IOrderRequest, 'payment' | 'address'>;
```
Данные, используемые в форме ввода электронной почти и телефона
```
export type TEmailPhoneForm = Pick<IOrderRequest, 'phone' | 'email'>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на страницеб
- слой данных, отвечает за хранение и изменение данныхб
- презентер, отвечает за связь представления и данныхю


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опцирнальный объект с заголовками запросов.
Методы:
 - `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
 - `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.


 #### Класс EventEmmitter
 Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
 Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
 - `on` - подписка на событие
 - `emit` - инициализация события
 - `trigger` - возвращает функцию, при вывозе которой инициализируется требуемое в параметрах событие.



 ### Классы моделей
Классы моделей используются для хранения и обработки данных, они определяют структуру данных и методы для работы с ними

#### Класс Catalog
Класс отвечает за хранение и логику работы с данными коллекции продуктов.\
Конструктор класса принимает инстант брокера событий.\

В полях класса хранятся следующие данные:
-  items: IProductItem[] | null - массив объектов с данными товаров,

Методы:
 - add(id: TProductId): void - добавляет товар в корзину
 - remove(id: TProductId): void - удаляет товар из корзины
 - openProduct(id: TProductId): IProductItem - открывает полную информацию о товаре в превью


#### Класс BasketModel
Класс отвечает за хранение и логику работы с данными корзины товаров.\
Конструктор класса принимает инстант брокера событий.\

Остновные методы, реализуемые классом описаны интерфейсом `IBasketModel`:
 - _items: TProductBaseInfo[] - массив данных товаров
 - add(id: string): void - добавляет товар в корзину
 - remove(id: string): void - удаляет товар из корзины
 - total(price: number): number - суммирует итоговую сумму заказа
 - _changed() - генерирует уведомление об изменении
 - а так же сеттеры и геттеры для сохранения и получения данных из полей класса


 #### Класс OrderData
 Класс отвечает за хранение и логику работы с данными покупателя.\
 Конструктор класса принимает инстант брокера событий.\

 В полях класса хранятся следующие данные:
 - payment: TPayment - выбранный способ оплаты
 - email: string - адрес электронный почты
 - phone: string - номер телефона
 - address: string - адрес получателя
 - items: TProductId[] - список покупаемых товаров
 - events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

 Так же класс предоставляет набор методов для взвимодействия с этими данными.\

 - checkValidation(data: Record<keyof TUserPublicInfo, string>): boolean - проверяет объект с данными пользователя на валидность



 ### Классы представления
 Все классы представления отвечают за отображения внутри контейнера (DOM-элемент) передаваемых в них данных.\

 #### Класс Modal
 Реализует модальное окно. Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по  Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

 - constructor(events: IEvents) - экземпляр класса `EventEmitter` для инициации событий.
 - closeButton: HTMLButtonElement кнопка закрытия модального окна
 - modal: HTMLElement - элемент модального окна
 - events: IEvents - брокер событий
 - open: void - метод открытия модального окна
 - close: void - метод закрытия модального окна


 #### Класс PreviewModal
 Расширяет класс Modal. Предназначен для реализации модального окна с описанием продукта. При сабмите добавляет товар в корзину.

 Поля класса:
 - button: HTMLButtonElement - кнопка `В корзину`
 - product: IProductItem - объект с данными продукта
 - imageElement: HTMLImageElement - изображение продукта
 - categoryElement: HTMLSpanElement - спан-элемент, содержащий информацию о категории продукта
 - titleProduct: HTMLElement - заголовок с названием товара
 - descriptionProduct: HTMLElement - текст описания товара
 - priceElement: HTMLSpanElement - элемент разметки с ценой товара

 Методы:
 - getCard(card: ProductCard): void - получает данные отображения карточки товара
 - setValid(isValid: boolean): void - изменяет активность кнопки сабмита
 - open(data: IProductItem): void - расширение родительского метода, принимает данные продукта, которые используются для заполнения элементов


#### Класс BasketModal
Расширяет класс Modal.Предназначен для реализации модального окна корзины товаров.
При сабмите закрывается модальное окно карзины и открывается модальное окно оформления заказа.

Поля:
- submitButton: HTMLButtonElement - кнопка `Оформить`,
- titleItem: HTMLHeadingElement - Элемент разметки с названием товара
- priceItem: HTMLSpanElement - элемент разметки с ценой товара
- deleteButton: HTMLButtonElement - кнопка удаления товара из корзины
- totalPrice: HTMLSpanElement - элемент разметки с общей стоимостью корзины.

Методы:
- createOrder: void - метод создания заказа
- getCard(card: ProductCard): void - получает данные отображения карточки товара
- getTotal(total: BasketModel.total): number - получает общую сумму заказа из модели корзины


#### Класс OrderFormModal
Расширяет класс Modal. Предназначен для реализации модального окна с формой оформления заказа.

Поля класса:
- submitButton: HtmlButtonElement - кнопка `Далее`
- _form: HTMLFormElement - элемент формы
- cardButton:HTMLButtonElement - кнопка `Онлайн`
- cashButton: HTMLButtonElement - кнопка `При получении`
- input: HTMLInputElement - поле ввода адреса получателя

Методы класса:
- setValid(isValid: boolean): void изменяет активность кнопки подтверждения
- setInputValue(data: string): void - сохраняет данные инпута в модель
- close(): void - расширяет родительский метод, дополнительно при закрытии очищая поле ввода формы
- get form: HTMLElement - геттер для получения элемента формы


#### Класс ContactsFormModal
Расширяет класс Modal. Предназначен для реализации модального окна с формой контактов покупателя.

Поля класса:
- submitButton: HtmlButtonElement - кнопка `Оплатить`
- _form: HTMLFormElement - элемент формы
- inputEmail: HTMLInputElement - поле ввода для электронной почты покупателя
- inputPhone: HTMLInputElement - поле ввода для телефона получателя

Методы:
- setValid(isValid: boolean): void изменяет активность кнопки подтверждения
- setInputValue(data: Record<string: string>): void - сохраняет данные инпута в модель
- close(): void - расширяет родительский метод, дополнительно при закрытии очищая поле ввода формы
- get form: HTMLElement - геттер для получения элемента формы


#### Класс SuccessModal
Расширяет класс Modal. Предназначен для реализации модального окна с подтвердением оплаты заказа.

Поля:
- close(): void - расширяет родительский метод, дополнительно при закрытии очищая корзину, когда получает код 200 от сервера.
- totalPrice: number - конечная сумма оплаченного заказа,
- orderSuccessButton: HTMLButtonElement - кнопка закрытия модального окна после совершенной оплаты.


#### Класс ProductCard ***
Отвечает за отображение продукта, задавая в карточке данные названия, изображения, описания, категории и цены. В конструкцию класса передается DOM-элемент теплейта, что позволяет формировать карточки разных вариантов верстки.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий./

Поля:
- previewButton: HTMLButtonElement - кнопка, открывающая модальное окно с превью товара
 - imageElement: HTMLImageElement - изображение продукта
 - categoryElement: HTMLSpanElement - спан-элемент, содержащий информацию о категории продукта
 - titleProduct: HTMLElement - заголовок с названием товара
 - descriptionProduct: HTMLElement - текст описания товара
 - priceElement: HTMLSpanElement - элемент разметки с ценой товара

Методы:
- setData(ProductData: IProductItem): void - заполняет атрибуты элементов карточки товара.
- render(): HTMLElement - метод возвращает полностью заполненную карточку товара с установленным слушателем события.


#### Класс CatalogView
Отвечает за отображение коллекции товаров на главной странице.
В конструктор принимает контейнер, в котором размещаются карточки. Имеет метод-сеттер для полученияя и обновления карточек каталога.



### Слой коммуникации
Классы, отвечающие за коммуникацию приложения с какими-либо внешними устройствами или приложениями, например, с сервером, где размещен бэкенд сайта.

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом магазина.

## Взаимодействие компонентов
Код, описывающий взаимодествие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаюся экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `basket:changed` - измение данных корзины товаров
- ``

*События, возникающие при взаимодецствии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `preview:open` - открытие модального окна с полным описанием товара
- `basket:open` - открытие модального окна с корзиной товаров
- `order:open` - открытие модального окна с формой оформления заказа
- `contacts:open` - открытие модального окна с формой контактов покупателя
- `payment: selected` - выбор способа оплаты
- `order:submit` - изменение данных в форме оформления заказа
- `contacts:submit` - изменение данных в форме контактов покупателя
- `order:validation` - событие, сообщающее о необходимости валидации формы оформления заказа
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактов покупателя
- `ui:basket-remove` - удаление товара из корзины
- `ui:basket-add` - добавление товара в корзину ?


